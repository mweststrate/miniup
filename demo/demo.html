<!DOCTYPE HTML>
<html>
	<head>
		<script src="../miniup.js"></script>
		<script src="js/jquery-1.7.1.min.js"></script>
		<script src="js/jquery.jsonview.js"></script>
		<link rel="stylesheet" href="css/jquery.jsonview.css" />
		<link rel="stylesheet" href="css/style.css" />
	</head>
	<body>
		<div class="content">
			<div id="intro-container">
				<div class="">
					<img src="../res/miniup.png" class="logo"/><h1>Miniup - Lightweight Parsing Library</h1>
				</div>
			</div>
			<div id="grammar-container">
				<div class="inner-container">
					<h1>Grammar</h1>
					<textarea id="grammar" tabindex="1">x = x 'a' / 'a'</textarea>
				</div>
			</div>
			<div id="input-container">
				<div class="inner-container">
					<div id="input-wrapper">
						<h1>Input</h1>
						<textarea id="input" tabindex="2">aaa</textarea>
						<input type="button" value="Parse!" id="parse-button" tabindex="3"/>
					</div>
					<div id="opts-wrapper">
						<p><b>Parse options</b></p>
						<form id="opts">
							<!--TODO: remove debug mode? -->
							<input type="checkbox" value="true" id="cleanAST">
							<label for="cleanAST">Clean AST</label></br/>
							<input type="checkbox" value="true" checked id="extendedAST">
							<label for="extendedAST">Extended AST</label></br/>
							<input type="checkbox" value="true" checked id="allowLeftRecursion">
							<label for="allowLeftRecursion">Support left recursion</label></br/>
							<input type="checkbox" value="true" checked id="optimize">
							<label for="optimize">Use optimizations</label></br/>
							<label for="startSymbol">Start symbol:</label>
							<input type="input" id="startSymbol"><br/>
						</form>
					</div>
				</div>
			</div>
			<div id="output-container">
				<div class="inner-container">
					<h1>Output</h1>
					<div id="output" class="output" tabindex="4"></div>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			$(function($) {
				function escapeHTML(text) {
					return $('<div/>').text(text).html();
				}

				function parse() {
					var params = {};
					$("#opts input").map(function() {
						var elem = $(this);
						params[elem.attr('id')] = (elem.attr('type') == 'checkbox') ? elem.attr('checked') == 'checked' : elem.attr('value');
					});
					try {
						var g = miniup.Grammar.load($('#grammar').val());
						var data = g.parse($('#input').val(), params);
						$('#output-container').removeClass("error").addClass("output");
						$('#output').JSONView(data);
					}
					catch (e) {
						$('#output-container').removeClass("output").addClass("error");
						$('#output').html(escapeHTML(e.name + ":\n\n" + e.message).replace(/\n/gi, "<br/>"));
					}
				};

				$('#parse-button').on('click', parse);
				$("#input").blur(parse);

				$("#input, #grammar").blur(function() {
					$(this).animate({'height': 40});
				}).focus(function() {
					$(this).animate({'height': 200});
				});
			});
		</script>
	</body>
</html>